<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë„ë˜ìš¸ë² ì´ìŠ¤ - í•™ìŠµ ì»¤ë®¤ë‹ˆí‹°</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Malgun Gothic', sans-serif;
            background: white;
            min-height: 100vh;
            margin: 0;
            padding: 0;
        }

        .wrapper {
            display: flex;
            min-height: 100vh;
            max-width: 1920px;
            margin: 0 auto;
            background: white;
        }

        /* ê´‘ê³  ì˜ì—­ */
        .ad-left, .ad-right {
            width: 300px;
            background: white;
            padding: 20px;
            padding-top: 150px;
            display: flex;
            align-items: flex-start;
            justify-content: center;
        }

        .ad-box {
            width: 250px;
            height: 600px;
            background: #f5f5f5;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #999;
            font-size: 16px;
            font-weight: 600;
            text-align: center;
        }

        .container {
            flex: 1;
            max-width: 1200px;
            background: white;
            min-height: 100vh;
        }

        /* í—¤ë” */
        header {
            background: white;
            border-bottom: 2px solid #e0e0e0;
            padding: 20px 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo-section {
            display: flex;
            align-items: center;
        }

        .logo-section img {
            height: 45px;
            width: auto;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-info {
            display: none;
            align-items: center;
            gap: 10px;
            padding: 8px 15px;
            background: #f5f5f5;
            border-radius: 20px;
        }

        .user-info.show {
            display: flex;
        }

        .user-profile-img {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            object-fit: cover;
        }

        .user-name {
            font-size: 14px;
            font-weight: 600;
            color: #333;
        }

        .admin-badge {
            color: #FFD700;
            font-weight: 700;
            margin-right: 3px;
        }

        .user-grade {
            font-size: 12px;
            color: #666;
        }

        .login-btn, .logout-btn {
            background: white;
            color: #1976d2;
            border: 2px solid #1976d2;
            padding: 10px 25px;
            border-radius: 5px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .login-btn:hover, .logout-btn:hover {
            background: #1976d2;
            color: white;
        }

        .logout-btn {
            display: none;
        }

        .logout-btn.show {
            display: block;
        }

        /* ê²€ìƒ‰ì°½ */
        .search-container {
            position: relative;
            display: flex;
            align-items: center;
            flex: 1;
            max-width: 500px;
            margin: 0 30px;
        }

        .search-input {
            width: 100%;
            padding: 10px 45px 10px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 25px;
            font-size: 14px;
            outline: none;
            transition: all 0.2s;
        }

        .search-input:focus {
            border-color: #1976d2;
            box-shadow: 0 0 0 3px rgba(25, 118, 210, 0.1);
        }

        .search-btn {
            position: absolute;
            right: 5px;
            background: none;
            border: none;
            font-size: 18px;
            cursor: pointer;
            padding: 8px 12px;
            border-radius: 50%;
            transition: background 0.2s;
        }

        .search-btn:hover {
            background: #f5f5f5;
        }

        .search-results {
            display: none;
            position: absolute;
            top: 50px;
            left: 0;
            right: 0;
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
            max-height: 500px;
            overflow-y: auto;
            z-index: 1000;
        }

        .search-results.show {
            display: block;
        }

        .search-section {
            padding: 15px;
        }

        .search-section-title {
            font-size: 13px;
            font-weight: 700;
            color: #666;
            margin-bottom: 10px;
            padding-bottom: 5px;
            border-bottom: 1px solid #e0e0e0;
        }

        .search-item {
            padding: 12px;
            cursor: pointer;
            border-radius: 8px;
            transition: background 0.2s;
            margin-bottom: 5px;
        }

        .search-item:hover {
            background: #f5f5f5;
        }

        .search-user-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .search-user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
        }

        .search-user-info {
            flex: 1;
        }

        .search-user-name {
            font-size: 14px;
            font-weight: 600;
            color: #333;
        }

        .search-user-grade {
            font-size: 12px;
            color: #666;
        }

        .search-post-item {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .search-post-category {
            display: inline-block;
            padding: 3px 8px;
            background: #e3f2fd;
            color: #1976d2;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
        }

        .search-post-title {
            font-size: 14px;
            font-weight: 600;
            color: #333;
        }

        .search-post-meta {
            font-size: 12px;
            color: #999;
        }

        .search-empty {
            padding: 30px;
            text-align: center;
            color: #999;
            font-size: 14px;
        }

        .user-info {
            cursor: pointer;
        }

        /* ë„¤ë¹„ê²Œì´ì…˜ */
        nav {
            background: white;
            border-bottom: 1px solid #e0e0e0;
            padding: 0 40px;
        }

        .nav-items {
            display: flex;
            gap: 0;
        }

        .nav-item {
            padding: 15px 25px;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 15px;
            font-weight: 500;
            color: #666;
            transition: all 0.2s ease;
            position: relative;
        }

        .nav-item:hover {
            color: #1976d2;
            background: #f8f9fa;
        }

        .nav-item.active {
            color: #1976d2;
            font-weight: 700;
        }

        .nav-item.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #1976d2, #42a5f5);
        }

        /* ë©”ì¸ ì»¨í…ì¸  */
        .main-content {
            padding: 30px 40px;
        }

        .board-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #333;
        }

        .board-title {
            font-size: 20px;
            font-weight: 700;
            color: #333;
        }

        .write-btn {
            background: linear-gradient(135deg, #42a5f5, #1976d2);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .write-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(25, 118, 210, 0.3);
        }

        /* ê²Œì‹œê¸€ í…Œì´ë¸” */
        .post-table {
            width: 100%;
            border-collapse: collapse;
            border-top: 1px solid #e0e0e0;
        }

        .post-table thead {
            background: #fafafa;
            border-bottom: 1px solid #e0e0e0;
        }

        .post-table th {
            padding: 12px 10px;
            font-size: 13px;
            font-weight: 600;
            color: #666;
            text-align: center;
        }

        .post-table th.title-col {
            text-align: left;
            padding-left: 20px;
        }

        .post-table td {
            padding: 15px 10px;
            font-size: 14px;
            color: #333;
            border-bottom: 1px solid #f0f0f0;
            text-align: center;
        }

        .post-table td.title-col {
            text-align: left;
            padding-left: 20px;
        }

        .post-table tbody tr {
            transition: background 0.2s ease;
            cursor: pointer;
        }

        .post-table tbody tr:hover {
            background: #f8f9fa;
        }

        .post-table tbody tr.notice-row {
            background: #fff5f5;
            border-left: 4px solid #f44336;
        }

        .post-table tbody tr.notice-row:hover {
            background: #ffebee;
        }

        .post-category-badge {
            display: inline-block;
            padding: 3px 8px;
            background: linear-gradient(135deg, #42a5f5, #1976d2);
            color: white;
            border-radius: 3px;
            font-size: 12px;
            font-weight: 600;
            margin-right: 8px;
        }

        .post-category-badge.notice {
            background: linear-gradient(135deg, #f44336, #d32f2f);
            font-weight: 700;
        }

        .post-title-text {
            color: #333;
            font-weight: 500;
        }

        .post-title-text:hover {
            color: #1976d2;
            text-decoration: underline;
        }

        .comment-count {
            color: #1976d2;
            font-weight: 600;
            margin-left: 5px;
        }

        .post-author {
            color: #666;
        }

        .post-date {
            color: #999;
            font-size: 13px;
        }

        .post-stats {
            color: #999;
            font-size: 13px;
        }

        /* í˜ì´ì§€ë„¤ì´ì…˜ */
        .pagination {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin-top: 30px;
            padding: 20px 0;
        }

        .pagination-btn {
            padding: 8px 12px;
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            color: #333;
            transition: all 0.2s ease;
        }

        .pagination-btn:hover:not(:disabled) {
            background: #f5f5f5;
            border-color: #1976d2;
            color: #1976d2;
        }

        .pagination-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .pagination-btn.active {
            background: #1976d2;
            color: white;
            border-color: #1976d2;
        }

        .page-input-group {
            display: flex;
            align-items: center;
            gap: 5px;
            margin-left: 10px;
        }

        .page-input {
            width: 50px;
            padding: 6px 8px;
            border: 1px solid #e0e0e0;
            border-radius: 5px;
            text-align: center;
            font-size: 14px;
        }

        .page-go-btn {
            padding: 6px 12px;
            background: #1976d2;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s ease;
        }

        .page-go-btn:hover {
            background: #1565c0;
        }

        /* ë°˜ì‘í˜• */
        @media (max-width: 1400px) {
            .ad-left, .ad-right {
                display: none;
            }

            .wrapper {
                justify-content: center;
            }
        }

        @media (max-width: 768px) {
            /* ê´‘ê³  ì˜ì—­ ìˆ¨ê¸°ê¸° */
            .ad-left, .ad-right {
                display: none;
            }

            /* ë˜í¼ ì¤‘ì•™ ì •ë ¬ */
            .wrapper {
                flex-direction: column;
            }

            .container {
                width: 100%;
                max-width: 100%;
            }

            /* í—¤ë” ëª¨ë°”ì¼ ìµœì í™” */
            header {
                padding: 15px;
                flex-direction: column;
                gap: 10px;
            }

            .logo-section {
                justify-content: center;
            }

            .logo-section img {
                max-width: 180px;
                height: auto;
            }

            /* ê²€ìƒ‰ì°½ ëª¨ë°”ì¼ ìµœì í™” */
            .search-container {
                width: 100%;
                max-width: 100%;
            }

            .search-input {
                font-size: 14px;
                padding: 10px 15px;
            }

            /* ì‚¬ìš©ì ì •ë³´ ëª¨ë°”ì¼ ìµœì í™” */
            .header-right {
                width: 100%;
                justify-content: center;
            }

            .user-info {
                padding: 8px 15px;
            }

            .user-profile-img {
                width: 30px;
                height: 30px;
            }

            .user-name {
                font-size: 13px;
            }

            .user-grade {
                font-size: 11px;
            }

            .login-btn, .logout-btn {
                padding: 10px 20px;
                font-size: 14px;
            }

            /* ë„¤ë¹„ê²Œì´ì…˜ ëª¨ë°”ì¼ ìµœì í™” */
            nav {
                padding: 0 15px;
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }

            .nav-items {
                min-width: max-content;
                gap: 5px;
            }

            .nav-item {
                padding: 10px 12px;
                font-size: 13px;
                white-space: nowrap;
            }

            /* ë©”ì¸ ì»¨í…ì¸  ëª¨ë°”ì¼ ìµœì í™” */
            .main-content {
                padding: 15px;
            }

            .board-header {
                flex-direction: row;
                gap: 10px;
            }

            .board-title {
                font-size: 18px;
            }

            .write-btn {
                padding: 10px 15px;
                font-size: 13px;
            }

            /* í…Œì´ë¸” ëª¨ë°”ì¼ ìµœì í™” */
            .post-table {
                font-size: 12px;
                display: block;
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }

            .post-table thead {
                display: block;
            }

            .post-table tbody {
                display: block;
            }

            .post-table tr {
                display: table;
                width: 100%;
                table-layout: fixed;
            }

            .post-table th,
            .post-table td {
                padding: 8px 4px;
                font-size: 12px;
            }

            /* ì¡°íšŒìˆ˜, ì¢‹ì•„ìš” ìˆ¨ê¸°ê¸° */
            .col-views,
            .col-likes {
                display: none !important;
            }

            .post-table th:first-child,
            .post-table td:first-child {
                width: 50px !important;
            }

            .post-table th:nth-child(3),
            .post-table td:nth-child(3) {
                width: 70px !important;
            }

            .post-table th:nth-child(4),
            .post-table td:nth-child(4) {
                width: 80px !important;
                font-size: 11px;
            }

            .title-col {
                max-width: none;
            }

            .post-title-text {
                display: block;
                overflow: hidden;
                text-overflow: ellipsis;
                white-space: nowrap;
                max-width: 150px;
            }

            .post-category-badge {
                font-size: 10px;
                padding: 2px 6px;
            }

            .comment-count {
                font-size: 11px;
            }

            /* í˜ì´ì§€ë„¤ì´ì…˜ ëª¨ë°”ì¼ ìµœì í™” */
            .pagination {
                flex-wrap: wrap;
                gap: 5px;
                padding: 15px 10px;
            }

            .pagination-btn {
                padding: 6px 10px;
                font-size: 12px;
                min-width: 35px;
            }

            .page-input-group {
                width: 100%;
                margin-top: 10px;
            }

            .page-input {
                width: 60px;
                padding: 6px;
                font-size: 12px;
            }

            .page-go-btn {
                padding: 6px 12px;
                font-size: 12px;
            }

            /* ê²€ìƒ‰ ê²°ê³¼ ëª¨ë°”ì¼ ìµœì í™” */
            .search-results {
                max-width: calc(100vw - 30px);
                max-height: 60vh;
            }

            .search-section-title {
                font-size: 12px;
                padding: 8px 12px;
            }

            .search-item {
                padding: 10px 12px;
                font-size: 13px;
            }
        }

        /* ë¡œë”© ìŠ¤í”¼ë„ˆ */
        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        .loading::after {
            content: 'ë¡œë”© ì¤‘...';
        }
    </style>
</head>
<body>
    <div class="wrapper">
        <!-- ì™¼ìª½ ê´‘ê³  -->
        <div class="ad-left">
            <div class="ad-box">
                ê´‘ê³  ì˜ì—­<br>(250x600)
            </div>
        </div>

        <!-- ë©”ì¸ ì»¨í…ì¸  -->
        <div class="container">
            <!-- í—¤ë” -->
            <header>
                <div class="logo-section">
                    <img src="images/logo.png" alt="ë„ë˜ìš¸ë² ì´ìŠ¤">
                </div>
                <!-- ê²€ìƒ‰ì°½ -->
                <div class="search-container">
                    <input type="text" class="search-input" id="searchInput" placeholder="ì‚¬ìš©ì, ê²Œì‹œê¸€ ê²€ìƒ‰..." autocomplete="off">
                    <button class="search-btn" onclick="performSearch()">ğŸ”</button>
                    <div class="search-results" id="searchResults"></div>
                </div>
                <div class="header-right">
                    <!-- ì‚¬ìš©ì ì •ë³´ (ë¡œê·¸ì¸ ì‹œ í‘œì‹œ) -->
                    <div class="user-info" id="userInfo" onclick="goToMyProfile()">
                        <img class="user-profile-img" id="userProfileImg" src="" alt="í”„ë¡œí•„">
                        <div>
                            <div class="user-name" id="userName"></div>
                            <div class="user-grade" id="userGrade"></div>
                        </div>
                    </div>
                    <!-- ë¡œê·¸ì¸ ë²„íŠ¼ -->
                    <button class="login-btn" id="loginBtn" onclick="goToLogin()">ë¡œê·¸ì¸</button>
                    <!-- ë¡œê·¸ì•„ì›ƒ ë²„íŠ¼ -->
                    <button class="logout-btn" id="logoutBtn" onclick="logout()">ë¡œê·¸ì•„ì›ƒ</button>
                </div>
            </header>

            <!-- ë„¤ë¹„ê²Œì´ì…˜ -->
            <nav>
                <div class="nav-items">
                    <button class="nav-item active" onclick="filterCategory('all')">ì „ì²´ ê²Œì‹œíŒ</button>
                    <button class="nav-item" onclick="filterCategory('notice')">ê³µì§€ì‚¬í•­</button>
                    <button class="nav-item" onclick="filterCategory('info')">ìë£ŒÂ·ì •ë³´ ê³µìœ </button>
                    <button class="nav-item" onclick="filterCategory('question')">ì§ˆë¬¸ê²Œì‹œíŒ</button>
                    <button class="nav-item" onclick="filterCategory('free')">ììœ ê²Œì‹œíŒ</button>
                </div>
            </nav>

            <!-- ë©”ì¸ ì»¨í…ì¸  -->
            <div class="main-content">
                <div class="board-header">
                    <div class="board-title">ì „ì²´ ê²Œì‹œíŒ</div>
                    <button class="write-btn" onclick="goToWrite()">ê¸€ì“°ê¸°</button>
                </div>

                <table class="post-table">
                    <thead>
                        <tr>
                            <th style="width: 60px;">ë²ˆí˜¸</th>
                            <th class="title-col">ì œëª©</th>
                            <th style="width: 100px;">ì‘ì„±ì</th>
                            <th style="width: 100px;">ë‚ ì§œ</th>
                            <th class="col-views" style="width: 70px;">ì¡°íšŒìˆ˜</th>
                            <th class="col-likes" style="width: 70px;">ì¢‹ì•„ìš”</th>
                        </tr>
                    </thead>
                    <tbody id="postTableBody">
                        <tr>
                            <td colspan="6" class="loading"></td>
                        </tr>
                    </tbody>
                </table>

                <!-- í˜ì´ì§€ë„¤ì´ì…˜ -->
                <div class="pagination" id="pagination"></div>
            </div>
        </div>
        <!-- /ë©”ì¸ ì»¨í…ì¸  -->

        <!-- ì˜¤ë¥¸ìª½ ê´‘ê³  -->
        <div class="ad-right">
            <div class="ad-box">
                ê´‘ê³  ì˜ì—­<br>(250x600)
            </div>
        </div>
    </div>
    <!-- /wrapper -->

    <script>
        let currentUser = null;
        let allPosts = [];
        let topNotices = []; // ê³µì§€ì‚¬í•­ ìµœì‹  3ê°œ
        let currentPage = 1;
        const postsPerPage = 30;
        let currentCategory = 'all';
        let paginationData = null; // ì„œë²„ì—ì„œ ë°›ì€ í˜ì´ì§€ë„¤ì´ì…˜ ì •ë³´

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì‹¤í–‰
        window.addEventListener('load', async () => {
            await checkLogin();
            await loadPosts();
        });

        // ë¡œê·¸ì¸ ìƒíƒœ í™•ì¸
        async function checkLogin() {
            try {
                const response = await fetch('/api/user');
                const data = await response.json();
                
                if (data.success && data.user) {
                    currentUser = data.user;
                    updateUserUI();
                }
            } catch (error) {
                console.error('ë¡œê·¸ì¸ ìƒíƒœ í™•ì¸ ì‹¤íŒ¨:', error);
            }
        }

        // ì‚¬ìš©ì UI ì—…ë°ì´íŠ¸
        function updateUserUI() {
            if (currentUser) {
                // ì‚¬ìš©ì ì •ë³´ í‘œì‹œ
                const userInfo = document.getElementById('userInfo');
                const userName = document.getElementById('userName');
                const userGrade = document.getElementById('userGrade');
                const userProfileImg = document.getElementById('userProfileImg');
                
                // ê´€ë¦¬ì ë±ƒì§€
                const adminBadge = currentUser.role === 'admin' ? '<span class="admin-badge">[ê´€ë¦¬ì]</span>' : '';
                userName.innerHTML = `${adminBadge}${currentUser.name}`;
                userGrade.textContent = `${currentUser.grade}í•™ë…„`;
                userProfileImg.src = currentUser.profileImage || 'https://via.placeholder.com/35';
                
                // ë²„íŠ¼ ì „í™˜
                userInfo.classList.add('show');
                document.getElementById('loginBtn').style.display = 'none';
                document.getElementById('logoutBtn').classList.add('show');
            }
        }

        // ê²Œì‹œê¸€ ë¡œë“œ
        async function loadPosts(page = 1) {
            try {
                // ì¹´í…Œê³ ë¦¬ë³„ í•„í„°ë§ì„ ìœ„í•´ ë§ì€ ê²Œì‹œê¸€ì„ ê°€ì ¸ì˜´
                // 'all' ì¹´í…Œê³ ë¦¬ì¼ ë•ŒëŠ” ì„œë²„ í˜ì´ì§€ë„¤ì´ì…˜ í™œìš©
                const limit = currentCategory === 'all' ? postsPerPage : 500;
                const requestPage = currentCategory === 'all' ? page : 1;

                const response = await fetch(`/api/posts?page=${requestPage}&limit=${limit}`);
                const data = await response.json();

                if (data.success) {
                    allPosts = data.posts;
                    topNotices = data.topNotices || []; // ì„œë²„ì—ì„œ ë°›ì€ ê³µì§€ì‚¬í•­ ìµœì‹  3ê°œ
                    paginationData = data.pagination;

                    // ì¹´í…Œê³ ë¦¬ë³„ í•„í„°ë§ì´ ì•„ë‹Œ ê²½ìš° ì„œë²„ í˜ì´ì§€ë„¤ì´ì…˜ ì‚¬ìš©
                    if (currentCategory === 'all') {
                        currentPage = page;
                    }

                    renderPosts();
                }
            } catch (error) {
                console.error('ê²Œì‹œê¸€ ë¡œë“œ ì‹¤íŒ¨:', error);
                document.getElementById('postTableBody').innerHTML = `
                    <tr><td colspan="6" style="padding: 40px; color: #f44336;">
                        ê²Œì‹œê¸€ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.
                    </td></tr>
                `;
            }
        }

        // ê²Œì‹œê¸€ ë Œë”ë§
        function renderPosts() {
            const tbody = document.getElementById('postTableBody');
            tbody.innerHTML = '';

            let postsToDisplay = [];

            // ê³µì§€ì‚¬í•­ ì¹´í…Œê³ ë¦¬ì¸ ê²½ìš° ê³µì§€ì‚¬í•­ë§Œ í‘œì‹œ
            if (currentCategory === 'notice') {
                postsToDisplay = topNotices;
            }
            // ì „ì²´ ê²Œì‹œíŒì¸ ê²½ìš°
            else if (currentCategory === 'all') {
                // ê³µì§€ì‚¬í•­ ìµœì‹  3ê°œ + ì„œë²„ì—ì„œ í˜ì´ì§€ë„¤ì´ì…˜ëœ ì¼ë°˜ ê²Œì‹œê¸€
                postsToDisplay = [...topNotices, ...allPosts];
            }
            // íŠ¹ì • ì¹´í…Œê³ ë¦¬ì¸ ê²½ìš° (ì •ë³´, ì§ˆë¬¸, ììœ )
            else {
                // ê³µì§€ì‚¬í•­ ìµœì‹  3ê°œ + í•´ë‹¹ ì¹´í…Œê³ ë¦¬ ê²Œì‹œê¸€
                const filteredPosts = allPosts.filter(post => post.category === currentCategory);

                // í´ë¼ì´ì–¸íŠ¸ í˜ì´ì§€ë„¤ì´ì…˜ ì ìš©
                const startIndex = (currentPage - 1) * postsPerPage;
                const endIndex = startIndex + postsPerPage;
                const paginatedPosts = filteredPosts.slice(startIndex, endIndex);

                postsToDisplay = [...topNotices, ...paginatedPosts];
            }

            // ê²Œì‹œê¸€ì´ ì—†ëŠ” ê²½ìš°
            if (postsToDisplay.length === 0) {
                tbody.innerHTML = `
                    <tr><td colspan="6" style="padding: 40px; color: #999;">
                        ê²Œì‹œê¸€ì´ ì—†ìŠµë‹ˆë‹¤.
                    </td></tr>
                `;
                return;
            }

            // ê²Œì‹œê¸€ ë Œë”ë§
            postsToDisplay.forEach((post) => {
                const tr = document.createElement('tr');
                tr.onclick = () => viewPost(post.id);

                if (post.category === 'notice') {
                    tr.classList.add('notice-row');
                }

                const badgeClass = post.category === 'notice' ? 'post-category-badge notice' : 'post-category-badge';

                // ì‘ì„±ì í´ë¦­ ê°€ëŠ¥í•˜ê²Œ
                const authorHtml = post.authorId
                    ? `<span style="cursor: pointer; text-decoration: underline;" onclick="event.stopPropagation(); goToProfile(${post.authorId});">${post.author}</span>`
                    : post.author;

                tr.innerHTML = `
                    <td>${post.id}</td>
                    <td class="title-col">
                        <span class="${badgeClass}">${post.categoryName}</span>
                        <span class="post-title-text">${post.title}</span>
                        <span class="comment-count">[${post.comments}]</span>
                    </td>
                    <td class="post-author">${authorHtml}</td>
                    <td class="post-date">${post.date} ${post.time}</td>
                    <td class="col-views post-stats">ì¡°íšŒìˆ˜: ${post.views}</td>
                    <td class="col-likes post-stats">ì¢‹ì•„ìš”: ${post.likes}</td>
                `;

                tbody.appendChild(tr);
            });

            // í˜ì´ì§€ë„¤ì´ì…˜ ë Œë”ë§
            if (currentCategory === 'all') {
                renderPagination(null); // ì„œë²„ í˜ì´ì§€ë„¤ì´ì…˜ ì‚¬ìš©
            } else if (currentCategory === 'notice') {
                renderPagination(topNotices); // ê³µì§€ì‚¬í•­ë§Œ
            } else {
                // íŠ¹ì • ì¹´í…Œê³ ë¦¬ì˜ ê²Œì‹œê¸€ë§Œ (ê³µì§€ì‚¬í•­ ì œì™¸)
                const filteredPosts = allPosts.filter(post => post.category === currentCategory);
                renderPagination(filteredPosts);
            }
        }

        // í˜ì´ì§€ë„¤ì´ì…˜ ë Œë”ë§
        function renderPagination(postsToPage) {
            const pagination = document.getElementById('pagination');
            pagination.innerHTML = '';

            // ì„œë²„ í˜ì´ì§€ë„¤ì´ì…˜ ì‚¬ìš© (postsToPageê°€ nullì¼ ë•Œ)
            let totalPages;
            if (postsToPage === null && paginationData) {
                totalPages = paginationData.totalPages;
            } else if (postsToPage) {
                totalPages = Math.ceil(postsToPage.length / postsPerPage);
            } else {
                totalPages = 1;
            }

            if (totalPages <= 1) {
                pagination.style.display = 'none';
                return;
            }
            pagination.style.display = 'flex';

            // ì´ì „ ë²„íŠ¼
            const prevBtn = document.createElement('button');
            prevBtn.className = 'pagination-btn';
            prevBtn.textContent = 'â—€ ì´ì „';
            prevBtn.disabled = currentPage === 1;
            prevBtn.onclick = () => goToPage(currentPage - 1);
            pagination.appendChild(prevBtn);

            // í˜ì´ì§€ ë²ˆí˜¸ ë²„íŠ¼ë“¤
            const startPage = Math.max(1, currentPage - 2);
            const endPage = Math.min(totalPages, currentPage + 2);

            if (startPage > 1) {
                const firstBtn = document.createElement('button');
                firstBtn.className = 'pagination-btn';
                firstBtn.textContent = '1';
                firstBtn.onclick = () => goToPage(1);
                pagination.appendChild(firstBtn);

                if (startPage > 2) {
                    const dots = document.createElement('span');
                    dots.textContent = '...';
                    dots.style.padding = '0 5px';
                    pagination.appendChild(dots);
                }
            }

            for (let i = startPage; i <= endPage; i++) {
                const pageBtn = document.createElement('button');
                pageBtn.className = 'pagination-btn' + (i === currentPage ? ' active' : '');
                pageBtn.textContent = i;
                pageBtn.onclick = () => goToPage(i);
                pagination.appendChild(pageBtn);
            }

            if (endPage < totalPages) {
                if (endPage < totalPages - 1) {
                    const dots = document.createElement('span');
                    dots.textContent = '...';
                    dots.style.padding = '0 5px';
                    pagination.appendChild(dots);
                }

                const lastBtn = document.createElement('button');
                lastBtn.className = 'pagination-btn';
                lastBtn.textContent = totalPages;
                lastBtn.onclick = () => goToPage(totalPages);
                pagination.appendChild(lastBtn);
            }

            // ë‹¤ìŒ ë²„íŠ¼
            const nextBtn = document.createElement('button');
            nextBtn.className = 'pagination-btn';
            nextBtn.textContent = 'ë‹¤ìŒ â–¶';
            nextBtn.disabled = currentPage === totalPages;
            nextBtn.onclick = () => goToPage(currentPage + 1);
            pagination.appendChild(nextBtn);

            // í˜ì´ì§€ ì…ë ¥ ê·¸ë£¹
            const inputGroup = document.createElement('div');
            inputGroup.className = 'page-input-group';
            inputGroup.innerHTML = `
                <input type="number" class="page-input" id="pageInput" min="1" max="${totalPages}" value="${currentPage}">
                <button class="page-go-btn" onclick="goToInputPage()">ì´ë™</button>
            `;
            pagination.appendChild(inputGroup);
        }

        // ì¹´í…Œê³ ë¦¬ í•„í„°ë§
        async function filterCategory(category) {
            currentCategory = category;
            currentPage = 1;

            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            event.target.classList.add('active');

            // ê²Œì‹œíŒ ì œëª© ì—…ë°ì´íŠ¸
            const boardTitle = document.querySelector('.board-title');
            const categoryMap = {
                'all': 'ì „ì²´ ê²Œì‹œíŒ',
                'notice': 'ê³µì§€ì‚¬í•­',
                'info': 'ìë£ŒÂ·ì •ë³´ ê³µìœ ',
                'question': 'ì§ˆë¬¸ê²Œì‹œíŒ',
                'free': 'ììœ ê²Œì‹œíŒ'
            };
            boardTitle.textContent = categoryMap[category];

            // ì¹´í…Œê³ ë¦¬ ë³€ê²½ ì‹œ ì„œë²„ì—ì„œ ë‹¤ì‹œ ë¡œë“œ
            await loadPosts(1);
        }

        // í˜ì´ì§€ ì´ë™
        async function goToPage(page) {
            // ì„œë²„ í˜ì´ì§€ë„¤ì´ì…˜ ì‚¬ìš© ('all' ì¹´í…Œê³ ë¦¬)
            if (currentCategory === 'all') {
                if (paginationData && (page < 1 || page > paginationData.totalPages)) return;
                await loadPosts(page);
                window.scrollTo({ top: 0, behavior: 'smooth' });
                return;
            }

            // í´ë¼ì´ì–¸íŠ¸ í˜ì´ì§€ë„¤ì´ì…˜ (íŠ¹ì • ì¹´í…Œê³ ë¦¬)
            const filteredPosts = allPosts.filter(post => post.category === currentCategory);
            const regularPosts = filteredPosts.filter(post => post.category !== 'notice');
            const totalPages = Math.ceil(regularPosts.length / postsPerPage);

            if (page < 1 || page > totalPages) return;

            currentPage = page;
            renderPosts();
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // ì…ë ¥í•œ í˜ì´ì§€ë¡œ ì´ë™
        function goToInputPage() {
            const input = document.getElementById('pageInput');
            const page = parseInt(input.value);

            const filteredPosts = currentCategory === 'all' 
                ? allPosts 
                : allPosts.filter(post => post.category === currentCategory);
            
            const regularPosts = filteredPosts.filter(post => post.category !== 'notice');
            const totalPages = Math.ceil(regularPosts.length / postsPerPage);

            if (isNaN(page) || page < 1 || page > totalPages) {
                alert(`ì¡´ì¬í•˜ì§€ ì•ŠëŠ” í˜ì´ì§€ì…ë‹ˆë‹¤.\n1ë¶€í„° ${totalPages}ê¹Œì§€ì˜ í˜ì´ì§€ë§Œ ìˆìŠµë‹ˆë‹¤.`);
                input.value = currentPage;
                return;
            }

            goToPage(page);
        }

        // ê²Œì‹œê¸€ ìƒì„¸ ë³´ê¸°
        function viewPost(postId) {
            window.location.href = `/post-detail?id=${postId}`;
        }

        // ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™
        function goToLogin() {
            window.location.href = '/auth/kakao';
        }

        // ë¡œê·¸ì•„ì›ƒ
        async function logout() {
            if (!confirm('ë¡œê·¸ì•„ì›ƒ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;

            try {
                const response = await fetch('/api/logout', { method: 'POST' });
                const data = await response.json();
                
                if (data.success) {
                    alert('ë¡œê·¸ì•„ì›ƒë˜ì—ˆìŠµë‹ˆë‹¤.');
                    window.location.reload();
                }
            } catch (error) {
                console.error('ë¡œê·¸ì•„ì›ƒ ì‹¤íŒ¨:', error);
                alert('ë¡œê·¸ì•„ì›ƒì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            }
        }

        // ê¸€ì“°ê¸° í˜ì´ì§€ë¡œ ì´ë™
        function goToWrite() {
            if (!currentUser) {
                alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
                goToLogin();
                return;
            }
            window.location.href = '/write-post';
        }

        // í”„ë¡œí•„ í˜ì´ì§€ë¡œ ì´ë™
        function goToProfile(userId) {
            if (userId) {
                window.location.href = `/profile?id=${userId}`;
            }
        }

        // ë‚´ í”„ë¡œí•„ë¡œ ì´ë™
        function goToMyProfile() {
            if (currentUser) {
                window.location.href = `/profile?id=${currentUser.id}`;
            }
        }

        // ê²€ìƒ‰ ê¸°ëŠ¥
        let searchTimeout = null;
        const searchInput = document.getElementById('searchInput');
        const searchResults = document.getElementById('searchResults');

        // ê²€ìƒ‰ ì…ë ¥ ì´ë²¤íŠ¸
        searchInput.addEventListener('input', () => {
            clearTimeout(searchTimeout);
            searchTimeout = setTimeout(() => {
                performSearch();
            }, 300);
        });

        // ê²€ìƒ‰ ê²°ê³¼ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
        document.addEventListener('click', (e) => {
            if (!e.target.closest('.search-container')) {
                searchResults.classList.remove('show');
            }
        });

        // ê²€ìƒ‰ ìˆ˜í–‰
        async function performSearch() {
            const query = searchInput.value.trim();
            
            if (query.length < 2) {
                searchResults.classList.remove('show');
                return;
            }

            try {
                const response = await fetch(`/api/search?q=${encodeURIComponent(query)}`);
                const data = await response.json();

                if (data.success) {
                    displaySearchResults(data.users, data.posts);
                }
            } catch (error) {
                console.error('ê²€ìƒ‰ ì‹¤íŒ¨:', error);
            }
        }

        // ê²€ìƒ‰ ê²°ê³¼ í‘œì‹œ
        function displaySearchResults(users, posts) {
            let html = '';

            // ì‚¬ìš©ì ê²€ìƒ‰ ê²°ê³¼
            if (users && users.length > 0) {
                html += '<div class="search-section">';
                html += '<div class="search-section-title">ğŸ‘¤ ì‚¬ìš©ì</div>';
                
                users.forEach(user => {
                    const adminBadge = user.role === 'admin' ? '<span style="color: #FFD700; font-weight: 700;">[ê´€ë¦¬ì]</span> ' : '';
                    html += `
                        <div class="search-item search-user-item" onclick="goToProfile(${user.id})">
                            <img class="search-user-avatar" src="${user.profileImage || 'https://via.placeholder.com/40'}" alt="${user.name}">
                            <div class="search-user-info">
                                <div class="search-user-name">${adminBadge}${user.name}</div>
                                <div class="search-user-grade">${user.grade}í•™ë…„</div>
                            </div>
                        </div>
                    `;
                });
                
                html += '</div>';
            }

            // ê²Œì‹œê¸€ ê²€ìƒ‰ ê²°ê³¼
            if (posts && posts.length > 0) {
                html += '<div class="search-section">';
                html += '<div class="search-section-title">ğŸ“ ê²Œì‹œê¸€</div>';
                
                posts.forEach(post => {
                    html += `
                        <div class="search-item search-post-item" onclick="viewPost(${post.id})">
                            <div>
                                <span class="search-post-category">${post.categoryName}</span>
                            </div>
                            <div class="search-post-title">${post.title}</div>
                            <div class="search-post-meta">${post.author} Â· ${post.date} Â· ì¡°íšŒ ${post.views}</div>
                        </div>
                    `;
                });
                
                html += '</div>';
            }

            // ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ì„ ë•Œ
            if ((!users || users.length === 0) && (!posts || posts.length === 0)) {
                html = '<div class="search-empty">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
            }

            searchResults.innerHTML = html;
            searchResults.classList.add('show');
        }
    </script>
</body>
</html>
